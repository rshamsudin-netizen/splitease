<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#635bff">
  <meta name="description" content="Split expenses easily with friends and groups">
  
  <!-- PWA Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="SplitEase">
  
  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  
  <title>SplitEase</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap');
    
    * { 
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 0;
      overscroll-behavior: none;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-in {
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-12px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .card {
      background: white;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), 0 4px 12px rgba(0, 0, 0, 0.03);
    }
    
    .btn-primary {
      background: linear-gradient(180deg, #635bff 0%, #5851ea 100%);
      box-shadow: 0 1px 2px rgba(99, 91, 255, 0.2), 0 4px 12px rgba(99, 91, 255, 0.15);
      transition: all 0.15s ease;
    }
    
    .btn-primary:hover, .btn-primary:active {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(99, 91, 255, 0.25), 0 6px 16px rgba(99, 91, 255, 0.2);
    }
    
    .btn-secondary {
      background: white;
      border: 1px solid #e2e8f0;
      transition: all 0.15s ease;
    }
    
    .btn-secondary:hover, .btn-secondary:active {
      background: #f8fafc;
      border-color: #cbd5e1;
    }
    
    .input-field {
      border: 1px solid #e2e8f0;
      transition: all 0.15s ease;
      font-size: 16px; /* Prevents zoom on iOS */
    }
    
    .input-field:focus {
      outline: none;
      border-color: #635bff;
      box-shadow: 0 0 0 3px rgba(99, 91, 255, 0.1);
    }
    
    .chip {
      transition: all 0.15s ease;
    }
    
    .chip:active {
      transform: scale(0.98);
    }
    
    .chip-selected {
      background: linear-gradient(180deg, #635bff 0%, #5851ea 100%);
      color: white;
      box-shadow: 0 1px 3px rgba(99, 91, 255, 0.3);
    }
    
    .settlement-card {
      background: linear-gradient(135deg, #fafbff 0%, #f5f3ff 100%);
      border: 1px solid rgba(99, 91, 255, 0.1);
    }
    
    .group-card {
      transition: all 0.15s ease;
      cursor: pointer;
    }
    
    .group-card:active {
      transform: scale(0.98);
    }
    
    .group-card.active {
      border-color: #635bff;
      box-shadow: 0 0 0 3px rgba(99, 91, 255, 0.1);
    }
    
    .sidebar {
      background: linear-gradient(180deg, #fafbff 0%, #f1f5f9 100%);
    }
    
    /* Mobile sidebar */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        z-index: 50;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        width: 280px;
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .sidebar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        z-index: 40;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }
      
      .sidebar-overlay.open {
        opacity: 1;
        pointer-events: auto;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // Local Storage helpers
    const loadData = () => {
      try {
        const data = localStorage.getItem('splitease_data');
        return data ? JSON.parse(data) : { groups: [], activeGroupId: null };
      } catch {
        return { groups: [], activeGroupId: null };
      }
    };

    const saveData = (groups, activeGroupId) => {
      try {
        localStorage.setItem('splitease_data', JSON.stringify({ groups, activeGroupId }));
      } catch (e) {
        console.error('Failed to save data:', e);
      }
    };

    const SplitEase = () => {
      const [groups, setGroups] = useState(() => loadData().groups);
      const [activeGroupId, setActiveGroupId] = useState(() => loadData().activeGroupId);
      const [showCreateGroup, setShowCreateGroup] = useState(false);
      const [newGroupName, setNewGroupName] = useState('');
      const [newPerson, setNewPerson] = useState('');
      const [showAddExpense, setShowAddExpense] = useState(false);
      const [sidebarOpen, setSidebarOpen] = useState(false);
      const [expenseForm, setExpenseForm] = useState({
        description: '',
        amount: '',
        paidBy: '',
        splitAmong: []
      });

      // Save to localStorage whenever data changes
      useEffect(() => {
        saveData(groups, activeGroupId);
      }, [groups, activeGroupId]);

      const [showAddPayment, setShowAddPayment] = useState(false);
      const [paymentForm, setPaymentForm] = useState({
        from: '',
        to: '',
        amount: ''
      });

      const activeGroup = groups.find(g => g.id === activeGroupId);
      const people = activeGroup?.people || [];
      const expenses = activeGroup?.expenses || [];
      const payments = activeGroup?.payments || [];

      const createGroup = () => {
        if (newGroupName.trim()) {
          const newGroup = {
            id: Date.now(),
            name: newGroupName.trim(),
            people: [],
            expenses: [],
            payments: [],
            createdAt: new Date().toISOString()
          };
          setGroups([...groups, newGroup]);
          setActiveGroupId(newGroup.id);
          setNewGroupName('');
          setShowCreateGroup(false);
          setSidebarOpen(false);
        }
      };

      const deleteGroup = (groupId) => {
        setGroups(groups.filter(g => g.id !== groupId));
        if (activeGroupId === groupId) {
          setActiveGroupId(groups.length > 1 ? groups.find(g => g.id !== groupId)?.id : null);
        }
      };

      const updateGroup = (groupId, updates) => {
        setGroups(groups.map(g => g.id === groupId ? { ...g, ...updates } : g));
      };

      const addPerson = () => {
        if (newPerson.trim() && activeGroup && !people.includes(newPerson.trim())) {
          updateGroup(activeGroupId, { people: [...people, newPerson.trim()] });
          setNewPerson('');
        }
      };

      const removePerson = (name) => {
        if (activeGroup) {
          updateGroup(activeGroupId, {
            people: people.filter(p => p !== name),
            expenses: expenses.filter(e => e.paidBy !== name && !e.splitAmong.includes(name)),
            payments: payments.filter(p => p.from !== name && p.to !== name)
          });
        }
      };

      const addExpense = () => {
        if (activeGroup && expenseForm.description && expenseForm.amount && expenseForm.paidBy && expenseForm.splitAmong.length > 0) {
          updateGroup(activeGroupId, {
            expenses: [...expenses, {
              id: Date.now(),
              ...expenseForm,
              amount: parseFloat(expenseForm.amount)
            }]
          });
          setExpenseForm({ description: '', amount: '', paidBy: '', splitAmong: [] });
          setShowAddExpense(false);
        }
      };

      const removeExpense = (id) => {
        if (activeGroup) {
          updateGroup(activeGroupId, { expenses: expenses.filter(e => e.id !== id) });
        }
      };

      const addPayment = () => {
        if (activeGroup && paymentForm.from && paymentForm.to && paymentForm.amount && paymentForm.from !== paymentForm.to) {
          updateGroup(activeGroupId, {
            payments: [...payments, {
              id: Date.now(),
              ...paymentForm,
              amount: parseFloat(paymentForm.amount),
              date: new Date().toISOString()
            }]
          });
          setPaymentForm({ from: '', to: '', amount: '' });
          setShowAddPayment(false);
        }
      };

      const removePayment = (id) => {
        if (activeGroup) {
          updateGroup(activeGroupId, { payments: payments.filter(p => p.id !== id) });
        }
      };

      const toggleSplitPerson = (person) => {
        setExpenseForm(prev => ({
          ...prev,
          splitAmong: prev.splitAmong.includes(person)
            ? prev.splitAmong.filter(p => p !== person)
            : [...prev.splitAmong, person]
        }));
      };

      const selectGroup = (groupId) => {
        setActiveGroupId(groupId);
        setSidebarOpen(false);
      };

      const balances = useMemo(() => {
        const bal = {};
        people.forEach(p => bal[p] = 0);
        
        // Calculate from expenses
        expenses.forEach(expense => {
          const share = expense.amount / expense.splitAmong.length;
          bal[expense.paidBy] += expense.amount;
          expense.splitAmong.forEach(person => {
            bal[person] -= share;
          });
        });
        
        // Adjust for payments made
        payments.forEach(payment => {
          bal[payment.from] -= payment.amount; // Payer's balance decreases (paid off debt)
          bal[payment.to] += payment.amount;   // Receiver's balance increases (received payment)
        });
        
        return bal;
      }, [people, expenses, payments]);

      const settlements = useMemo(() => {
        const debtors = [];
        const creditors = [];
        
        Object.entries(balances).forEach(([person, balance]) => {
          if (balance < -0.01) debtors.push({ person, amount: -balance });
          else if (balance > 0.01) creditors.push({ person, amount: balance });
        });
        
        debtors.sort((a, b) => b.amount - a.amount);
        creditors.sort((a, b) => b.amount - a.amount);
        
        const result = [];
        let i = 0, j = 0;
        
        while (i < debtors.length && j < creditors.length) {
          const amount = Math.min(debtors[i].amount, creditors[j].amount);
          if (amount > 0.01) {
            result.push({
              from: debtors[i].person,
              to: creditors[j].person,
              amount: amount.toFixed(2)
            });
          }
          debtors[i].amount -= amount;
          creditors[j].amount -= amount;
          if (debtors[i].amount < 0.01) i++;
          if (creditors[j].amount < 0.01) j++;
        }
        
        return result;
      }, [balances]);

      const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);

      const getInitials = (name) => name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
      
      const getColor = (name) => {
        const colors = [
          'bg-indigo-500', 'bg-emerald-500', 'bg-amber-500', 'bg-rose-500', 
          'bg-cyan-500', 'bg-violet-500', 'bg-orange-500', 'bg-teal-500'
        ];
        let hash = 0;
        for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
        return colors[Math.abs(hash) % colors.length];
      };

      const getGroupIcon = (name) => {
        const icons = ['üè†', '‚úàÔ∏è', 'üçΩÔ∏è', 'üéâ', 'üèïÔ∏è', 'üéÆ', 'üõí', 'üíº'];
        let hash = 0;
        for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
        return icons[Math.abs(hash) % icons.length];
      };

      return (
        <div className="min-h-screen bg-slate-50">
          {/* Mobile Sidebar Overlay */}
          <div 
            className={`sidebar-overlay md:hidden ${sidebarOpen ? 'open' : ''}`}
            onClick={() => setSidebarOpen(false)}
          />

          <div className="flex min-h-screen">
            {/* Sidebar */}
            <aside className={`sidebar w-72 border-r border-slate-200 flex flex-col md:relative ${sidebarOpen ? 'open' : ''}`}>
              {/* Logo */}
              <div className="p-5 border-b border-slate-200">
                <div className="flex items-center gap-3">
                  <div className="w-9 h-9 rounded-lg bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                      <path d="M16 3h5v5M8 3H3v5M3 16v5h5M21 16v5h-5M12 8v8M8 12h8"/>
                    </svg>
                  </div>
                  <span className="text-xl font-semibold text-slate-900 tracking-tight">SplitEase</span>
                </div>
              </div>

              {/* Groups List */}
              <div className="flex-1 overflow-y-auto p-4">
                <div className="flex items-center justify-between mb-3">
                  <h2 className="text-xs font-semibold text-slate-500 uppercase tracking-wider">Groups</h2>
                  <button
                    onClick={() => setShowCreateGroup(true)}
                    className="w-6 h-6 rounded-md bg-indigo-50 text-indigo-600 flex items-center justify-center active:bg-indigo-100 transition-colors"
                  >
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round">
                      <path d="M12 5v14M5 12h14"/>
                    </svg>
                  </button>
                </div>

                {showCreateGroup && (
                  <div className="card p-3 mb-3 fade-in">
                    <input
                      type="text"
                      value={newGroupName}
                      onChange={(e) => setNewGroupName(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && createGroup()}
                      placeholder="Group name..."
                      className="input-field w-full px-3 py-2 rounded-lg text-sm mb-2"
                      autoFocus
                    />
                    <div className="flex gap-2">
                      <button
                        onClick={() => { setShowCreateGroup(false); setNewGroupName(''); }}
                        className="btn-secondary flex-1 px-3 py-1.5 rounded-lg text-xs font-medium text-slate-600"
                      >
                        Cancel
                      </button>
                      <button
                        onClick={createGroup}
                        className="btn-primary flex-1 px-3 py-1.5 rounded-lg text-white text-xs font-medium"
                      >
                        Create
                      </button>
                    </div>
                  </div>
                )}

                {groups.length === 0 && !showCreateGroup ? (
                  <div className="text-center py-8">
                    <div className="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-3">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                      </svg>
                    </div>
                    <p className="text-sm text-slate-500 mb-1">No groups yet</p>
                    <p className="text-xs text-slate-400">Create one to get started</p>
                  </div>
                ) : (
                  <div className="space-y-2">
                    {groups.map(group => {
                      const groupTotal = group.expenses.reduce((sum, e) => sum + e.amount, 0);
                      const groupPayments = (group.payments || []).reduce((sum, p) => sum + p.amount, 0);
                      return (
                        <div
                          key={group.id}
                          onClick={() => selectGroup(group.id)}
                          className={`group-card card p-3 slide-in ${activeGroupId === group.id ? 'active' : ''}`}
                        >
                          <div className="flex items-start justify-between">
                            <div className="flex items-center gap-3">
                              <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center text-lg">
                                {getGroupIcon(group.name)}
                              </div>
                              <div>
                                <p className="text-sm font-medium text-slate-900">{group.name}</p>
                                <p className="text-xs text-slate-400">
                                  {group.people.length} people ¬∑ ${groupTotal.toFixed(2)} spent
                                </p>
                              </div>
                            </div>
                            <button
                              onClick={(e) => { e.stopPropagation(); deleteGroup(group.id); }}
                              className="w-6 h-6 rounded-md flex items-center justify-center text-slate-300 hover:bg-slate-100 hover:text-slate-500 transition-all"
                            >
                              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round">
                                <path d="M18 6L6 18M6 6l12 12"/>
                              </svg>
                            </button>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            </aside>

            {/* Main Content */}
            <main className="flex-1 overflow-y-auto">
              {!activeGroup ? (
                <div className="flex items-center justify-center h-full p-6">
                  <div className="text-center">
                    <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-50 to-violet-50 flex items-center justify-center mx-auto mb-4">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#635bff" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M16 3h5v5M8 3H3v5M3 16v5h5M21 16v5h-5M12 8v8M8 12h8"/>
                      </svg>
                    </div>
                    <h2 className="text-lg font-semibold text-slate-900 mb-1">Welcome to SplitEase</h2>
                    <p className="text-sm text-slate-500 mb-4">Create a group to get started</p>
                    <button
                      onClick={() => { setShowCreateGroup(true); setSidebarOpen(true); }}
                      className="btn-primary px-5 py-2.5 rounded-lg text-white text-sm font-medium inline-flex items-center gap-2"
                    >
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round">
                        <path d="M12 5v14M5 12h14"/>
                      </svg>
                      Create Group
                    </button>
                  </div>
                </div>
              ) : (
                <>
                  {/* Header */}
                  <header className="bg-white border-b border-slate-100 sticky top-0 z-10">
                    <div className="px-4 md:px-8 py-4 md:py-5 flex items-center justify-between">
                      <div className="flex items-center gap-3 md:gap-4">
                        {/* Mobile menu button */}
                        <button
                          onClick={() => setSidebarOpen(true)}
                          className="md:hidden w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center text-slate-600"
                        >
                          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round">
                            <path d="M3 12h18M3 6h18M3 18h18"/>
                          </svg>
                        </button>
                        <div className="w-10 h-10 md:w-11 md:h-11 rounded-xl bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center text-lg md:text-xl">
                          {getGroupIcon(activeGroup.name)}
                        </div>
                        <div>
                          <h1 className="text-base md:text-lg font-semibold text-slate-900">{activeGroup.name}</h1>
                          <p className="text-xs text-slate-400">{people.length} people ¬∑ {expenses.length} expenses ¬∑ {payments.length} payments</p>
                        </div>
                      </div>
                      {totalExpenses > 0 && (
                        <div className="text-right">
                          <p className="text-xs text-slate-400 uppercase tracking-wider font-medium hidden md:block">Total</p>
                          <p className="text-lg md:text-xl font-semibold text-slate-900">${totalExpenses.toFixed(2)}</p>
                        </div>
                      )}
                    </div>
                  </header>

                  <div className="px-4 md:px-8 py-6 md:py-8 max-w-3xl">
                    {/* People Section */}
                    <section className="mb-6 md:mb-8 fade-in">
                      <div className="flex items-center justify-between mb-3 md:mb-4">
                        <h2 className="text-xs font-semibold text-slate-500 uppercase tracking-wider">People</h2>
                        <span className="text-xs text-slate-400">{people.length} added</span>
                      </div>
                      
                      <div className="card p-4 md:p-5">
                        <div className="flex gap-2 md:gap-3 mb-4">
                          <input
                            type="text"
                            value={newPerson}
                            onChange={(e) => setNewPerson(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && addPerson()}
                            placeholder="Add a person..."
                            className="input-field flex-1 px-3 md:px-4 py-2.5 rounded-lg text-sm"
                          />
                          <button 
                            onClick={addPerson}
                            className="btn-primary px-4 md:px-5 py-2.5 rounded-lg text-white text-sm font-medium"
                          >
                            Add
                          </button>
                        </div>
                        
                        {people.length === 0 ? (
                          <p className="text-slate-400 text-sm text-center py-6">Add people to start splitting expenses</p>
                        ) : (
                          <div className="flex flex-wrap gap-2">
                            {people.map(person => (
                              <div 
                                key={person}
                                className="chip flex items-center gap-2 bg-slate-50 px-3 py-2 rounded-full group"
                              >
                                <div className={`w-7 h-7 rounded-full ${getColor(person)} flex items-center justify-center text-white text-xs font-semibold`}>
                                  {getInitials(person)}
                                </div>
                                <span className="text-sm text-slate-700 font-medium">{person}</span>
                                <button 
                                  onClick={() => removePerson(person)}
                                  className="w-5 h-5 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center hover:bg-slate-300"
                                >
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round">
                                    <path d="M18 6L6 18M6 6l12 12"/>
                                  </svg>
                                </button>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </section>

                    {/* Expenses Section */}
                    <section className="mb-6 md:mb-8 fade-in">
                      <div className="flex items-center justify-between mb-3 md:mb-4">
                        <h2 className="text-xs font-semibold text-slate-500 uppercase tracking-wider">Expenses</h2>
                        {people.length >= 2 && !showAddExpense && (
                          <button 
                            onClick={() => setShowAddExpense(true)}
                            className="btn-primary px-3 md:px-4 py-2 rounded-lg text-white text-sm font-medium flex items-center gap-2"
                          >
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round">
                              <path d="M12 5v14M5 12h14"/>
                            </svg>
                            <span className="hidden sm:inline">Add Expense</span>
                            <span className="sm:hidden">Add</span>
                          </button>
                        )}
                      </div>

                      {showAddExpense && (
                        <div className="card p-4 md:p-5 mb-4 fade-in">
                          <div className="grid gap-4">
                            <div>
                              <label className="block text-xs font-medium text-slate-500 mb-1.5 uppercase tracking-wider">Description</label>
                              <input
                                type="text"
                                value={expenseForm.description}
                                onChange={(e) => setExpenseForm({...expenseForm, description: e.target.value})}
                                placeholder="Dinner, Uber, Groceries..."
                                className="input-field w-full px-3 md:px-4 py-2.5 rounded-lg text-sm"
                              />
                            </div>
                            
                            <div>
                              <label className="block text-xs font-medium text-slate-500 mb-1.5 uppercase tracking-wider">Amount</label>
                              <div className="relative">
                                <span className="absolute left-3 md:left-4 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                                <input
                                  type="number"
                                  step="0.01"
                                  inputMode="decimal"
                                  value={expenseForm.amount}
                                  onChange={(e) => setExpenseForm({...expenseForm, amount: e.target.value})}
                                  placeholder="0.00"
                                  className="input-field w-full pl-7 md:pl-8 pr-3 md:pr-4 py-2.5 rounded-lg text-sm"
                                />
                              </div>
                            </div>
                            
                            <div>
                              <label className="block text-xs font-medium text-slate-500 mb-1.5 uppercase tracking-wider">Paid by</label>
                              <div className="flex flex-wrap gap-2">
                                {people.map(person => (
                                  <button
                                    key={person}
                                    onClick={() => setExpenseForm({...expenseForm, paidBy: person})}
                                    className={`chip px-3 md:px-4 py-2 rounded-full text-sm font-medium border ${
                                      expenseForm.paidBy === person 
                                        ? 'chip-selected border-transparent' 
                                        : 'bg-white border-slate-200 text-slate-600'
                                    }`}
                                  >
                                    {person}
                                  </button>
                                ))}
                              </div>
                            </div>
                            
                            <div>
                              <label className="block text-xs font-medium text-slate-500 mb-1.5 uppercase tracking-wider">Split among</label>
                              <div className="flex flex-wrap gap-2">
                                {people.map(person => (
                                  <button
                                    key={person}
                                    onClick={() => toggleSplitPerson(person)}
                                    className={`chip px-3 md:px-4 py-2 rounded-full text-sm font-medium border ${
                                      expenseForm.splitAmong.includes(person)
                                        ? 'chip-selected border-transparent'
                                        : 'bg-white border-slate-200 text-slate-600'
                                    }`}
                                  >
                                    {person}
                                  </button>
                                ))}
                              </div>
                              <button
                                onClick={() => setExpenseForm({...expenseForm, splitAmong: [...people]})}
                                className="text-xs text-indigo-500 font-medium mt-2"
                              >
                                Select all
                              </button>
                            </div>
                            
                            <div className="flex gap-3 pt-2">
                              <button
                                onClick={() => setShowAddExpense(false)}
                                className="btn-secondary flex-1 px-4 py-2.5 rounded-lg text-sm font-medium text-slate-600"
                              >
                                Cancel
                              </button>
                              <button
                                onClick={addExpense}
                                disabled={!expenseForm.description || !expenseForm.amount || !expenseForm.paidBy || expenseForm.splitAmong.length === 0}
                                className="btn-primary flex-1 px-4 py-2.5 rounded-lg text-white text-sm font-medium disabled:opacity-50"
                              >
                                Add Expense
                              </button>
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="card overflow-hidden">
                        {expenses.length === 0 ? (
                          <p className="text-slate-400 text-sm text-center py-12">
                            {people.length < 2 ? 'Add at least 2 people to create expenses' : 'No expenses yet'}
                          </p>
                        ) : (
                          <div className="divide-y divide-slate-100">
                            {expenses.map(expense => (
                              <div key={expense.id} className="p-4 flex items-center justify-between group">
                                <div className="flex items-center gap-3 md:gap-4">
                                  <div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                      <rect x="2" y="5" width="20" height="14" rx="2"/>
                                      <path d="M2 10h20"/>
                                    </svg>
                                  </div>
                                  <div>
                                    <p className="text-sm font-medium text-slate-900">{expense.description}</p>
                                    <p className="text-xs text-slate-400">
                                      {expense.paidBy} paid ¬∑ Split {expense.splitAmong.length} way{expense.splitAmong.length > 1 ? 's' : ''}
                                    </p>
                                  </div>
                                </div>
                                <div className="flex items-center gap-3 md:gap-4">
                                  <span className="text-sm font-semibold text-slate-900">${expense.amount.toFixed(2)}</span>
                                  <button
                                    onClick={() => removeExpense(expense.id)}
                                    className="w-8 h-8 rounded-full flex items-center justify-center text-slate-400 hover:bg-slate-200 hover:text-slate-600 transition-all"
                                  >
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round">
                                      <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                    </svg>
                                  </button>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </section>

                    {/* Payments Section */}
                    <section className="mb-6 md:mb-8 fade-in">
                      <div className="flex items-center justify-between mb-3 md:mb-4">
                        <h2 className="text-xs font-semibold text-slate-500 uppercase tracking-wider">Payments Made</h2>
                        {people.length >= 2 && !showAddPayment && (
                          <button 
                            onClick={() => setShowAddPayment(true)}
                            className="btn-primary px-3 md:px-4 py-2 rounded-lg text-white text-sm font-medium flex items-center gap-2"
                          >
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round">
                              <path d="M12 5v14M5 12h14"/>
                            </svg>
                            <span className="hidden sm:inline">Record Payment</span>
                            <span className="sm:hidden">Pay</span>
                          </button>
                        )}
                      </div>

                      {showAddPayment && (
                        <div className="card p-4 md:p-5 mb-4 fade-in">
                          <div className="grid gap-4">
                            <div>
                              <label className="block text-xs font-medium text-slate-500 mb-1.5 uppercase tracking-wider">Who paid?</label>
                              <div className="flex flex-wrap gap-2">
                                {people.map(person => (
                                  <button
                                    key={person}
                                    onClick={() => setPaymentForm({...paymentForm, from: person})}
                                    className={`chip px-3 md:px-4 py-2 rounded-full text-sm font-medium border ${
                                      paymentForm.from === person 
                                        ? 'chip-selected border-transparent' 
                                        : 'bg-white border-slate-200 text-slate-600'
                                    }`}
                                  >
                                    {person}
                                  </button>
                                ))}
                              </div>
                            </div>
                            
                            <div>
                              <label className="block text-xs font-medium text-slate-500 mb-1.5 uppercase tracking-wider">Paid to?</label>
                              <div className="flex flex-wrap gap-2">
                                {people.filter(p => p !== paymentForm.from).map(person => (
                                  <button
                                    key={person}
                                    onClick={() => setPaymentForm({...paymentForm, to: person})}
                                    className={`chip px-3 md:px-4 py-2 rounded-full text-sm font-medium border ${
                                      paymentForm.to === person 
                                        ? 'chip-selected border-transparent' 
                                        : 'bg-white border-slate-200 text-slate-600'
                                    }`}
                                  >
                                    {person}
                                  </button>
                                ))}
                              </div>
                            </div>
                            
                            <div>
                              <label className="block text-xs font-medium text-slate-500 mb-1.5 uppercase tracking-wider">Amount</label>
                              <div className="relative">
                                <span className="absolute left-3 md:left-4 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                                <input
                                  type="number"
                                  step="0.01"
                                  inputMode="decimal"
                                  value={paymentForm.amount}
                                  onChange={(e) => setPaymentForm({...paymentForm, amount: e.target.value})}
                                  placeholder="0.00"
                                  className="input-field w-full pl-7 md:pl-8 pr-3 md:pr-4 py-2.5 rounded-lg text-sm"
                                />
                              </div>
                            </div>
                            
                            <div className="flex gap-3 pt-2">
                              <button
                                onClick={() => { setShowAddPayment(false); setPaymentForm({ from: '', to: '', amount: '' }); }}
                                className="btn-secondary flex-1 px-4 py-2.5 rounded-lg text-sm font-medium text-slate-600"
                              >
                                Cancel
                              </button>
                              <button
                                onClick={addPayment}
                                disabled={!paymentForm.from || !paymentForm.to || !paymentForm.amount || paymentForm.from === paymentForm.to}
                                className="btn-primary flex-1 px-4 py-2.5 rounded-lg text-white text-sm font-medium disabled:opacity-50"
                              >
                                Record Payment
                              </button>
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="card overflow-hidden">
                        {payments.length === 0 ? (
                          <p className="text-slate-400 text-sm text-center py-12">
                            {people.length < 2 ? 'Add at least 2 people to record payments' : 'No payments recorded yet'}
                          </p>
                        ) : (
                          <div className="divide-y divide-slate-100">
                            {payments.map(payment => (
                              <div key={payment.id} className="p-4 flex items-center justify-between group">
                                <div className="flex items-center gap-3 md:gap-4">
                                  <div className="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                      <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                    </svg>
                                  </div>
                                  <div>
                                    <p className="text-sm font-medium text-slate-900">
                                      {payment.from} ‚Üí {payment.to}
                                    </p>
                                    <p className="text-xs text-slate-400">
                                      {new Date(payment.date).toLocaleDateString()}
                                    </p>
                                  </div>
                                </div>
                                <div className="flex items-center gap-3 md:gap-4">
                                  <span className="text-sm font-semibold text-emerald-600">+${payment.amount.toFixed(2)}</span>
                                  <button
                                    onClick={() => removePayment(payment.id)}
                                    className="w-8 h-8 rounded-full flex items-center justify-center text-slate-400 hover:bg-slate-200 hover:text-slate-600 transition-all"
                                  >
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round">
                                      <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                    </svg>
                                  </button>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </section>

                    {/* Settlements Section */}
                    {settlements.length > 0 && (
                      <section className="fade-in">
                        <div className="flex items-center justify-between mb-3 md:mb-4">
                          <h2 className="text-xs font-semibold text-slate-500 uppercase tracking-wider">Settlements</h2>
                          <span className="text-xs text-slate-400">{settlements.length} payment{settlements.length > 1 ? 's' : ''}</span>
                        </div>
                        
                        <div className="space-y-3">
                          {settlements.map((s, i) => (
                            <div key={i} className="settlement-card rounded-xl p-4 flex items-center justify-between">
                              <div className="flex items-center gap-2 md:gap-3">
                                <div className={`w-8 h-8 md:w-9 md:h-9 rounded-full ${getColor(s.from)} flex items-center justify-center text-white text-xs font-semibold`}>
                                  {getInitials(s.from)}
                                </div>
                                <div className="flex items-center gap-1 md:gap-2 text-sm">
                                  <span className="font-medium text-slate-700 truncate max-w-[60px] md:max-w-none">{s.from}</span>
                                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <path d="M5 12h14M12 5l7 7-7 7"/>
                                  </svg>
                                  <span className="font-medium text-slate-700 truncate max-w-[60px] md:max-w-none">{s.to}</span>
                                </div>
                                <div className={`w-8 h-8 md:w-9 md:h-9 rounded-full ${getColor(s.to)} flex items-center justify-center text-white text-xs font-semibold`}>
                                  {getInitials(s.to)}
                                </div>
                              </div>
                              <span className="text-base md:text-lg font-semibold text-indigo-600">${s.amount}</span>
                            </div>
                          ))}
                        </div>

                        {/* Balance Summary */}
                        <div className="card mt-6 p-4 md:p-5">
                          <h3 className="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4">Balance Summary</h3>
                          <div className="space-y-3">
                            {Object.entries(balances).map(([person, balance]) => (
                              <div key={person} className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                  <div className={`w-8 h-8 rounded-full ${getColor(person)} flex items-center justify-center text-white text-xs font-semibold`}>
                                    {getInitials(person)}
                                  </div>
                                  <span className="text-sm font-medium text-slate-700">{person}</span>
                                </div>
                                <span className={`text-sm font-semibold ${
                                  balance > 0.01 ? 'text-emerald-600' : balance < -0.01 ? 'text-rose-600' : 'text-slate-400'
                                }`}>
                                  {balance > 0.01 ? '+' : ''}{balance.toFixed(2)}
                                </span>
                              </div>
                            ))}
                          </div>
                        </div>
                      </section>
                    )}
                  </div>
                </>
              )}
            </main>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<SplitEase />);
  </script>
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('SW registered'))
          .catch(err => console.log('SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
